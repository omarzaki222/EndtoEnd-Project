# Patch to add Docker support to existing Jenkins StatefulSet
# This patch adds Docker socket mount and Docker binary to Jenkins

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: jenkins
  namespace: jenkins
spec:
  template:
    spec:
      containers:
      - name: jenkins
        image: docker.io/jenkins/jenkins:2.504.2-jdk21
        volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
        - name: docker-bin
          mountPath: /usr/local/bin/docker
        env:
        - name: DOCKER_HOST
          value: unix:///var/run/docker.sock
        - name: PATH
          value: /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
      volumes:
      - name: docker-sock
        hostPath:
          path: /var/run/docker.sock
      - name: docker-bin
        hostPath:
          path: /usr/bin/docker
